version: '2'
services:

  frontend:
    image: teracy/angular-cli:1.0.0
    volumes:
      - ./:/app
    ports:
      - '4200:4200'
    container_name:
      frontend
    working_dir: /app
    command: bash -c "npm install && ng serve --host=0.0.0.0"

  db:
    extends:
      file: backend/database/docker-compose.yml
      service: db
    container_name:
      db

  liquibase:
    build: backend/database
    ports:
      - '2306:80'
    environment:
      HOST: db
      SCHEMA: navi
      USER: root
      PASSWORD: ""
    volumes:
      - ./backend/database/src/main/resources:/liquibase/changelog
    entrypoint: ["wait-for-it", "db:3306", "-t", "0", "--", "/run.sh"]

  core:
    build: backend
    container_name:
      core
    ports:
      - '90:8080'
      - '8787:8787'
      - '9990:9990'
    volumes:
      - ./backend/deployments:/opt/jboss/wildfly/standalone/deployments
    depends_on:
      - db
    environment:
      TZ: Europe/Warsaw
      APP_ENVIRONMENT: development
      APP_DB_HOST: db
    entrypoint: ["wait-for-it", "liquibase:80", "-t", "0", "--", "/start-server.sh"]


  core_compiler:
    build: backend/compiler
    volumes:
      - ./backend:/app
      - m2:/root/.m2
    container_name:
      core_compiler



volumes:
  m2: {}
